# 高特电池网关 Modbus RTU 驱动

## 设备信息

- 设备类型：高特电池网关
- 协议类型：Modbus RTU
- 功能码：`0x04`（`INPUT_REGISTER`）
- 驱动文件：`gaote_battery_gateway.go`
- 产物文件：`gaote_battery_gateway.wasm`

## 点表概览

### 电池单体（1~40）

- 电压：`U01~U40`，寄存器 `400~439`，表达式 `v/1000`，小数位 `3`
- 温度：`T01~T40`，寄存器 `800~839`，表达式 `v/10-40`，小数位 `1`
- 内阻：`IR01~IR40`，寄存器 `1200~1239`，表达式 `v/1000`，小数位 `3`

### 组级参数

| 属性名 | 属性标识 | 寄存器地址 | 寄存器数量 | 小数位 | 表达式 | 读写 |
|---|---|---:|---:|---:|---|---|
| 组电压 | `TU` | 0 | 2 | 1 | `v/10` | R |
| 组电流 | `TI` | 2 | 2 | 3 | `v/1000` | R |
| 环境温度 | `T` | 4 | 1 | 1 | `v/10-40` | R |

## 寄存器读取分组

- 组参数：`0~4`（5个寄存器）
- 单体电压：`400~439`（40个寄存器）
- 单体温度：`800~839`（40个寄存器）
- 单体内阻：`1200~1239`（40个寄存器）

## 返回示例 JSON

```json
{
  "success": true,
  "points": [
    {"field_name": "TU", "value": "53.2", "rw": "R", "unit": "V", "label": "组电压"},
    {"field_name": "TI", "value": "1.257", "rw": "R", "unit": "A", "label": "组电流"},
    {"field_name": "T", "value": "27.4", "rw": "R", "unit": "℃", "label": "环境温度"},
    {"field_name": "U01", "value": "2.138", "rw": "R", "unit": "V", "label": "电池1#电压"},
    {"field_name": "T01", "value": "26.3", "rw": "R", "unit": "℃", "label": "电池1#温度"},
    {"field_name": "IR01", "value": "0.245", "rw": "R", "unit": "Ω", "label": "电池1#内阻"}
  ]
}
```

## 编译

```bash
cd drvs/陆家嘴社区卫生服务中心/高特电池网关
make gaote_battery_gateway.wasm
```

## 网关配置建议

- `device_address`：设备从站地址（默认 `1`）
- 串口参数：按现场设备一致配置（波特率/数据位/校验/停止位）
- 排障建议：可开启 `debug=true` 查看收发帧
